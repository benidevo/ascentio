{{define "layouts/base.html"}}
<!DOCTYPE html>
<html lang="en" hx-ext="response-targets">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ascentio - {{.title}}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.4"></script>
  <script src="https://unpkg.com/htmx.org/dist/ext/response-targets.js"></script>
  <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
  <!-- HTMX response-targets extension is enabled globally -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      htmx.config.responseTargetUnsetsError = true;
    });
  </script>
  <!-- Configure Tailwind with color theme and fonts -->
  <script>
    tailwind.config = {
      theme: {
        fontFamily: {
          'sans': ['DM Sans', 'Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
          'heading': ['Space Grotesk', 'DM Sans', 'ui-sans-serif', 'system-ui', 'sans-serif']
        },
        extend: {
          colors: {
            primary: '#0D9488',
            'primary-dark': '#0B7A70',
            secondary: '#F59E0B',
          },
          fontSize: {
            'xs': ['0.75rem', { lineHeight: '1rem' }],
            'sm': ['0.875rem', { lineHeight: '1.25rem' }],
            'base': ['1rem', { lineHeight: '1.5rem' }],
            'lg': ['1.125rem', { lineHeight: '1.75rem' }],
            'xl': ['1.25rem', { lineHeight: '1.75rem' }],
            '2xl': ['1.5rem', { lineHeight: '2rem' }],
            '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
            '4xl': ['2.25rem', { lineHeight: '2.5rem' }],
            '5xl': ['3rem', { lineHeight: '1' }],
            '6xl': ['3.75rem', { lineHeight: '1' }],
          }
        }
      }
    }
  </script>
  <style>
    /* Base font styling */
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Space Grotesk', 'DM Sans', ui-sans-serif, system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: -0.025em;
    }
    
    body {
      font-family: 'DM Sans', 'Inter', ui-sans-serif, system-ui, sans-serif;
      font-weight: 400;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* HTMX indicator styling */
    .htmx-indicator {
      display: none !important;
      pointer-events: none !important;
    }
    .htmx-request .htmx-indicator {
      display: flex !important;
      pointer-events: auto !important;
    }
    .htmx-request.htmx-indicator {
      display: flex !important;
      pointer-events: auto !important;
    }

    /* Toast animations */
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fade-in 0.3s ease-in-out;
    }

    @keyframes fade-out {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    .animate-fade-out {
      animation: fade-out 0.3s ease-in-out forwards;
    }

    /* Custom animation keyframes */
    @keyframes float {
      0% { transform: translateY(0px) translateX(0px); }
      33% { transform: translateY(-10px) translateX(5px); }
      66% { transform: translateY(-5px) translateX(-5px); }
      100% { transform: translateY(0px) translateX(0px); }
    }

    .animate-float {
      animation: float 8s ease-in-out infinite;
    }

    @keyframes pulse-slow {
      0% { opacity: 0.8; }
      50% { opacity: 0.3; }
      100% { opacity: 0.8; }
    }

    .animate-pulse-slow {
      animation: pulse-slow 6s ease-in-out infinite;
    }

    /* Modern background effects */
    @keyframes drift {
      0% { transform: translateX(0px) translateY(0px) rotate(0deg); }
      33% { transform: translateX(30px) translateY(-30px) rotate(120deg); }
      66% { transform: translateX(-20px) translateY(20px) rotate(240deg); }
      100% { transform: translateX(0px) translateY(0px) rotate(360deg); }
    }

    .animate-drift {
      animation: drift 20s ease-in-out infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200px 0; }
      100% { background-position: calc(200px + 100%) 0; }
    }

    .animate-shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
      background-size: 200px 100%;
      animation: shimmer 3s ease-in-out infinite;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
</head>
<body class="bg-slate-900 text-gray-100 font-sans">
  <!-- Use template switching based on page variable -->
  {{if eq .page "dashboard"}}
    <!-- Dashboard has a different layout -->
    <div class="min-h-screen bg-slate-900">
      {{template "dashboard-content" .}}
    </div>
  {{else if eq .page "job-new"}}
    <!-- Job form uses the job-specific template -->
    <div class="min-h-screen bg-slate-900">
      {{template "job-new-content" .}}
    </div>
  {{else if eq .page "job-details"}}
    <!-- Job details page -->
    <div class="min-h-screen bg-slate-900">
      {{template "job-details-content" .}}
    </div>
  {{else if eq .page "404"}}
    <!-- 404 Not Found page -->
    {{template "404-content" .}}
  {{else if eq .page "500"}}
    <!-- 500 Server Error page -->
    {{template "500-content" .}}
  {{else if eq .page "settings-home" }}
    <!-- Settings home page -->
    <div class="min-h-screen bg-slate-900">
      {{template "settings-layout" .}}
    </div>
  {{else if eq .page "settings-profile" }}
    <!-- Settings profile page -->
    <div class="min-h-screen bg-slate-900">
      {{template "settings-layout" .}}
    </div>
  {{else if eq .page "settings-security" }}
    <!-- Settings security page -->
    <div class="min-h-screen bg-slate-900">
      {{template "settings-layout" .}}
    </div>
  {{else if eq .page "settings-notifications" }}
    <!-- Settings notifications page -->
    <div class="min-h-screen bg-slate-900">
      {{template "settings-layout" .}}
    </div>
  {{else}}
    <!-- Modern layout with enhanced backgrounds for home and login pages -->
    <div class="{{if eq .page "login"}}h-screen overflow-hidden{{else}}min-h-screen{{end}} flex {{if eq .page "home"}}flex-col{{end}} items-center justify-center relative overflow-hidden">
      
      <!-- Multi-layer background system -->
      <div class="absolute inset-0 z-0">
        <!-- Base gradient -->
        <div class="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900"></div>
        
        <!-- Animated mesh gradient -->
        <div class="absolute inset-0 bg-gradient-to-br from-primary/10 via-transparent via-transparent to-secondary/10 animate-pulse-slow"></div>
        
        <!-- Dynamic geometric shapes -->
        <div class="absolute inset-0 overflow-hidden">
          <!-- Large floating orbs -->
          <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl animate-float" style="animation-delay: 0s;"></div>
          <div class="absolute bottom-1/4 right-1/4 w-80 h-80 bg-secondary/5 rounded-full blur-3xl animate-float" style="animation-delay: 2s;"></div>
          <div class="absolute top-1/2 right-1/3 w-64 h-64 bg-blue-400/5 rounded-full blur-3xl animate-float" style="animation-delay: 4s;"></div>
          
          <!-- Geometric grid pattern -->
          <div class="absolute inset-0 opacity-10">
            <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                  <path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" stroke-width="1" class="text-primary/20"/>
                </pattern>
              </defs>
              <rect width="100%" height="100%" fill="url(#grid)" />
            </svg>
          </div>
          
          <!-- Floating abstract shapes -->
          <div class="absolute top-20 left-20 w-32 h-32 border border-primary/20 rounded-lg rotate-45 animate-pulse"></div>
          <div class="absolute bottom-32 left-1/3 w-24 h-24 border border-secondary/20 rounded-full animate-pulse" style="animation-delay: 1s;"></div>
          <div class="absolute top-1/3 right-20 w-40 h-2 bg-gradient-to-r from-primary/20 to-transparent rounded-full animate-pulse" style="animation-delay: 3s;"></div>
        </div>
        
        <!-- Particles overlay -->
        <div id="particles-js" class="h-full w-full"></div>
        
        <!-- Subtle noise texture overlay -->
        <div class="absolute inset-0 opacity-20 bg-gradient-to-br from-transparent via-slate-700/5 to-transparent"></div>
      </div>

      <!-- Content area with backdrop blur -->
      <div class="relative z-10 w-full {{if eq .page "home"}}{{else}}h-full{{end}}">
        {{if eq .page "home"}}
          <div class="backdrop-blur-sm bg-black/5 min-h-screen flex flex-col items-center justify-center">
            {{template "home-content" .}}
          </div>
        {{else if eq .page "login"}}
          <div class="w-full h-full flex items-center justify-center py-4 sm:py-8 backdrop-blur-sm">
            {{template "login-content" .}}
          </div>
        {{else}}
          <div class="z-10 text-white">Unknown page template</div>
        {{end}}
      </div>
    </div>
  {{end}}


  <!-- Shared Delete Modal -->
  {{template "delete-modal" .}}

  <!-- Global scripts -->
  <script>
    // Global function to auto-dismiss alerts
    function setupAutoDismissAlerts() {
      // Find all alerts with the auto-dismiss-alert class
      const alerts = document.querySelectorAll('.auto-dismiss-alert');

      // For each alert, set a timeout to remove it
      alerts.forEach(alert => {
        setTimeout(() => {
          // Add fade-out animation
          alert.style.transition = 'opacity 0.5s ease-out';
          alert.style.opacity = '0';

          // After animation completes, remove the element
          setTimeout(() => {
            if (alert.parentNode) {
              alert.parentNode.removeChild(alert);
            }
          }, 500); // 500ms matches the transition duration
        }, 3000); // 3 second delay before starting fade-out
      });
    }

    // Format UTC dates to local browser timezone
    function formatUTCDates() {
      const timeElements = document.querySelectorAll('.utc-time');

      timeElements.forEach(element => {
        const utcDate = element.getAttribute('data-utc');
        const format = element.getAttribute('data-format') || 'full';

        if (utcDate) {
          const date = new Date(utcDate);

          // Skip invalid dates
          if (isNaN(date)) return;

          let formattedDate = '';

          // Format based on the format attribute
          if (format === 'full') {
            // Format parts separately to ensure consistent output
            const datePart = date.toLocaleDateString(undefined, {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            });

            const timePart = date.toLocaleTimeString(undefined, {
              hour: 'numeric',
              minute: '2-digit',
              hour12: true
            });

            // Combine with "at" between date and time
            formattedDate = `${datePart} at ${timePart}`;
          } else if (format === 'date') {
            // Date only: January 2, 2023
            formattedDate = date.toLocaleDateString(undefined, {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            });
          } else if (format === 'time') {
            // Time only: 3:04 PM
            formattedDate = date.toLocaleTimeString(undefined, {
              hour: 'numeric',
              minute: '2-digit',
              hour12: true
            });
          }

          element.textContent = formattedDate;
        }
      });
    }

    // Run the auto-dismiss setup whenever the DOM content changes
    // This handles both initial page load and HTMX swaps
    document.addEventListener('DOMContentLoaded', function() {
      setupAutoDismissAlerts();
      formatUTCDates();
    });
    document.body.addEventListener('htmx:afterSwap', function() {
      setupAutoDismissAlerts();
      formatUTCDates();
    });

    // Initialize particles.js on all pages that have a particles-js element
    document.addEventListener('DOMContentLoaded', function() {
      const particlesContainer = document.getElementById('particles-js');
      if (particlesContainer) {
        // Detect mobile devices and reduce particle count for performance
        const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        
        // Mobile-optimized configuration
        const particleConfig = {
          particles: {
            number: {
              value: isMobile ? 40 : 100,
              density: { enable: true, value_area: isMobile ? 600 : 800 }
            },
            color: {
              value: ["#0D9488", "#F59E0B", "#0EA5E9", "#8B5CF6"]
            },
            shape: {
              type: "circle",
              stroke: { width: 0, color: "#000000" },
              polygon: { nb_sides: 5 }
            },
            opacity: {
              value: isMobile ? 0.1 : 0.15,
              random: true,
              anim: { 
                enable: !isReducedMotion, 
                speed: isMobile ? 0.5 : 0.8, 
                opacity_min: 0.05, 
                sync: false 
              }
            },
            size: {
              value: isMobile ? 3 : 4,
              random: true,
              anim: { 
                enable: !isReducedMotion, 
                speed: isMobile ? 1 : 1.5, 
                size_min: 0.1, 
                sync: false 
              }
            },
            line_linked: {
              enable: !isMobile,
              distance: 150,
              color: "#0D9488",
              opacity: 0.12,
              width: 1
            },
            move: {
              enable: !isReducedMotion,
              speed: isMobile ? 0.5 : 0.8,
              direction: "none",
              random: true,
              straight: false,
              out_mode: "out",
              bounce: false,
              attract: { enable: !isMobile, rotateX: 600, rotateY: 1200 }
            }
          },
          interactivity: {
            detect_on: "canvas",
            events: {
              onhover: { enable: !isMobile, mode: "grab" },
              onclick: { enable: true, mode: "push" },
              resize: true
            },
            modes: {
              grab: {
                distance: 180,
                line_linked: { opacity: 0.25 }
              },
              bubble: {
                distance: 250,
                size: 6,
                duration: 2,
                opacity: 0.2,
                speed: 3
              },
              repulse: {
                distance: 150,
                duration: 0.4
              },
              push: {
                particles_nb: isMobile ? 2 : 4
              },
              remove: {
                particles_nb: 2
              }
            }
          },
          retina_detect: true
        };
        
        // Initialize particles with mobile-optimized config
        particlesJS('particles-js', particleConfig);
      }

      // Handle HTMX events for any page using HTMX
      if (typeof htmx !== 'undefined') {
        // Handle different response statuses
        document.body.addEventListener('htmx:beforeSwap', function(event) {
          if (event.detail.xhr.status === 401 || event.detail.xhr.status === 400) {
            // Allow 400/401 responses to be swapped as they contain user-friendly error messages
            event.detail.shouldSwap = true;
            event.detail.isError = false;
          } else if (event.detail.xhr.status >= 500) {
            // Prevent 500+ errors from being swapped into content areas
            event.detail.shouldSwap = false;
            // Show a user-friendly error message instead
            if (event.detail.target) {
              event.detail.target.innerHTML = `
                <div class="bg-red-900 bg-opacity-50 border border-red-700 text-red-200 p-3 rounded-md mb-3 text-sm" _="on load wait 5s then transition opacity to 0 over 0.5s then remove me">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-red-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Something went wrong. Please try again later.</span>
                  </div>
                </div>
              `;
            }
          }
        });

        // Hide spinner on any error
        document.body.addEventListener('htmx:responseError', function(event) {
          const spinner = document.getElementById('spinner');
          if (spinner) {
            spinner.classList.add('htmx-hide');
          }
        });
      }
    });
  </script>
</body>
</html>
{{end}}