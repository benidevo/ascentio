{{define "delete-modal"}}
<div id="delete-modal-shared" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden"
     role="dialog"
     aria-modal="true"
     aria-labelledby="delete-modal-title"
     aria-describedby="delete-message"
     _="on keydown[key=='Escape'] from window add .hidden to me
        on click if event.target.id == 'delete-modal-shared' add .hidden to me">
  <div class="bg-slate-800 rounded-lg shadow-lg p-6 max-w-md w-full mx-4 border border-slate-700">
    <h2 id="delete-modal-title" class="sr-only">Confirm Deletion</h2>
    <p id="delete-message" class="text-gray-300 mb-6">Are you sure you want to delete this item? This action cannot be undone.</p>
    <div class="flex justify-end space-x-3">
      <button
        class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md"
        aria-label="Cancel deletion"
        _="on click add .hidden to #delete-modal-shared">
        Cancel
      </button>
      <button
        id="confirm-delete-btn"
        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md"
        aria-label="Confirm deletion"
        _="on click
           js
             const itemToDelete = window.getDeleteItem ? window.getDeleteItem() : null;
             if (itemToDelete) {
               document.getElementById('delete-modal-shared').classList.add('hidden');
               
               if (!itemToDelete.url) {
                 const event = new CustomEvent('client-delete', { detail: itemToDelete });
                 document.dispatchEvent(event);
                 window.clearDeleteItem();
                 return;
               }
               
               let url;
               try {
                 url = new URL(itemToDelete.url, window.location.origin);
                 if (url.origin !== window.location.origin) {
                   console.error('Invalid URL: Cross-origin request not allowed');
                   window.clearDeleteItem();
                   return;
                 }
               } catch (e) {
                 console.error('Invalid URL:', e);
                 window.clearDeleteItem();
                 return;
               }
               
               const allowedMethods = ['DELETE', 'POST', 'PUT'];
               const method = itemToDelete.method || 'DELETE';
               if (!allowedMethods.includes(method.toUpperCase())) {
                 console.error('Invalid HTTP method');
                 window.clearDeleteItem();
                 return;
               }
               
               const metaTag = document.querySelector('meta[name=csrf-token]');
               const csrfToken = metaTag ? metaTag.getAttribute('content') : '';
               fetch(url.href, {
                 method: method,
                 headers: {
                   'HX-Request': 'true',
                   'X-CSRF-Token': csrfToken
                 }
               })
               .then(response => {
                 if (response.ok) {
                   const redirectUrl = response.headers.get('HX-Redirect');
                   if (redirectUrl) {
                     try {
                       const redirectUrlObj = new URL(redirectUrl, window.location.origin);
                       if (redirectUrlObj.origin === window.location.origin) {
                         window.location.href = redirectUrlObj.href;
                       } else {
                         window.location.reload();
                       }
                     } catch (e) {
                       window.location.reload();
                     }
                   } else {
                     window.location.reload();
                   }
                 }
               })
               .catch(error => {
                 console.error('Delete failed:', error);
               })
               .finally(() => {
                 window.clearDeleteItem();
               });
             }
           end">
        Delete
      </button>
    </div>
  </div>
</div>
{{end}}